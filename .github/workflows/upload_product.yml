name: Upload iOS App Product

on:
  pull_request:
    branches:
      - qa
  
  push:
    branches:
      - cd-automation

jobs:
  Distribute:
    runs-on: macos-latest
    environment: Configuration Files
    steps:
      - uses: actions/checkout@v3
      - uses: jdx/mise-action@v2

      - name: Debug Directory Location
        run: |
          ls -la

      - name: Install Tuist
        run: |
          bash <(curl -Ls https://install.tuist.io)

      - name: Create Release.xcconfig
        env:
          BASE_URL: ${{ secrets.BASE_URL }}
          KAKAO_API_KEY: ${{ secrets.KAKAO_API_KEY }}
        run: |
          echo "// Configuration settings file format documentation can be found at:" > Release.xcconfig
          echo "// https://help.apple.com/xcode/#/dev745c5c974" >> Release.xcconfig
          echo "// API 엔드 포인트 주소" >> Release.xcconfig
          echo "BASE_URL = $BASE_URL" >> Release.xcconfig
          echo "// 카카오 API 키" >> Release.xcconfig
          echo "KAKAO_API_KEY = $KAKAO_API_KEY" >> Release.xcconfig
          cat Release.xcconfig
          mv Release.xcconfig EATSSU_MVC/EATSSU_MVC/Resources

          echo "// Configuration settings file format documentation can be found at:" > Debug.xcconfig
          echo "// https://help.apple.com/xcode/#/dev745c5c974" >> Debug.xcconfig
          echo "// API 엔드 포인트 주소" >> Debug.xcconfig
          echo "BASE_URL = $BASE_URL" >> Debug.xcconfig
          echo "// 카카오 API 키" >> Debug.xcconfig
          echo "KAKAO_API_KEY = $KAKAO_API_KEY" >> Debug.xcconfig
          cat Debug.xcconfig
          mv Debug.xcconfig EATSSU_MVC/EATSSU_MVC/Resources

      - name: Install Dependencies
        run: |
          tuist install
      
      - name: Build Project
        run: |
          tuist build